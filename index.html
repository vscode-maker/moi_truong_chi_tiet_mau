<!doctype html>
<html lang="en"
  class="layout-compact layout-menu-collapsed layout-menu-fixed"
  dir="ltr"
  data-skin="default"
  data-assets-path="./assets/"
  data-template="vertical-menu-template"
  data-bs-theme="light"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>CEFINEA | QUẢN LÝ CHI TIẾT MẪU</title>
    <meta name="description" content="Quản lý tiến độ phân tích chi tiết mẫu trong phòng thí nghiệm" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./assets/img/favicon/logo.png" />
    <script>
      localStorage.setItem("templateCustomizer-vertical-menu-template--Color", "#2092EC")
      localStorage.removeItem('templateCustomizer-vertical-menu-template--ContentLayout');
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&ampdisplay=swap" rel="stylesheet" />

    <link rel="stylesheet" href="./assets/vendor/fonts/iconify-icons.css" />

    <!-- Core CSS -->    
    <link rel="stylesheet" href="./assets/vendor/libs/node-waves/node-waves.css" />

    <link rel="stylesheet" href="./assets/vendor/libs/pickr/pickr-themes.css" />

    <link rel="stylesheet" href="./assets/vendor/css/core.css" />
    <link rel="stylesheet" href="./assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/datatables-fixedcolumns-bs5/fixedcolumns.bootstrap5.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.css" />

    <link rel="stylesheet" href="./assets/vendor/libs/animate-css/animate.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/sweetalert2/sweetalert2.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/notyf/notyf.css" />

    <!-- Page CSS -->
    <link rel="stylesheet" href="./assets/css/app-sample-details.css">

    <!-- Helpers -->
    <script src="./assets/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->

    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js. -->
    <script src="./assets/vendor/js/template-customizer.js"></script>

    <!--? Config: Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file. -->

    <script src="./assets/js/config.js"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">        

        <!-- Layout container -->
        <div class="layout-page">

          <!-- #region [Navbar] -->
          <nav class="layout-navbar container-fluid navbar-detached navbar navbar-expand-xl align-items-center bg-navbar-theme" id="layout-navbar">

            <div class="navbar-nav-right d-flex align-items-center justify-content-end" id="navbar-collapse">              

              <ul class="navbar-nav flex-row align-items-center ms-md-auto">              

                <!-- #region [Mode Switcher] -->
                <li class="nav-item dropdown me-sm-2 me-xl-0">
                  <a
                    class="nav-link dropdown-toggle hide-arrow btn btn-icon btn-text-secondary rounded-pill"
                    id="nav-theme"
                    href="javascript:void(0);"
                    data-bs-toggle="dropdown">
                    <i class="icon-base ri ri-sun-line icon-22px theme-icon-active"></i>
                    <span class="d-none ms-2" id="nav-theme-text">Toggle theme</span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-theme-text">
                    <li>
                      <button
                        type="button"
                        class="dropdown-item align-items-center active"
                        data-bs-theme-value="light"
                        aria-pressed="false">
                        <span> <i class="icon-base ri ri-sun-line icon-md me-3" data-icon="sun-line"></i>Light</span>
                      </button>
                    </li>
                    <li>
                      <button
                        type="button"
                        class="dropdown-item align-items-center"
                        data-bs-theme-value="dark"
                        aria-pressed="true">
                        <span>
                          <i class="icon-base ri ri-moon-clear-line icon-md me-3" data-icon="moon-clear-line"></i
                          >Dark</span
                        >
                      </button>
                    </li>
                    <li>
                      <button
                        type="button"
                        class="dropdown-item align-items-center"
                        data-bs-theme-value="system"
                        aria-pressed="false">
                        <span>
                          <i class="icon-base ri ri-computer-line icon-md me-3" data-icon="computer-line"></i
                          >System</span
                        >
                      </button>
                    </li>
                  </ul>
                </li>
                <!-- #endregion -->                        

                <!-- #region [User] -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a
                    class="nav-link dropdown-toggle hide-arrow p-0"
                    href="javascript:void(0);"
                    data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img src="./assets/img/favicon/logo.png" alt="Logo" class="rounded-circle" />
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                    <li>
                      <a class="dropdown-item" href="javaScript:void(0);">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0 me-2">
                            <div class="avatar avatar-online">
                              <img
                                src="./assets/img/favicon/logo.png"
                                alt="Logo"
                                class="w-px-40 h-auto rounded-circle" />
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-0 small">User Name</h6>
                            <small class="text-body-secondary">Admin</small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="javaScript:void(0);">
                        <i class="icon-base ri ri-user-3-line icon-22px me-2"></i>
                        <span class="align-middle">My Profile</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="javaScript:void(0);">
                        <i class="icon-base ri ri-settings-4-line icon-22px me-2"></i>
                        <span class="align-middle">Settings</span>
                      </a>
                    </li>                    
                    <li>
                      <div class="d-grid px-4 pt-2 pb-1">
                        <a class="btn btn-danger d-flex" href="javaScript:void(0);" target="_blank">
                          <small class="align-middle">Logout</small>
                          <i class="icon-base ri ri-logout-box-r-line ms-2 icon-16px"></i>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li>
                <!-- #endregion -->

              </ul>

            </div>

          </nav>
          <!-- #endregion -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
            <div class="container-fluid flex-grow-1 container-p-y">
              <!-- Page Header -->
              <div class="row">
                <div class="col-12">
                  <div class="card bg-primary text-white mb-4">
                    <div class="card-body">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <h4 class="card-title text-white mb-2">
                            <i class="ri-flask-line me-2"></i>
                            Quản lý Chi tiết mẫu
                          </h4>
                          <p class="card-text mb-0 text-white-50">
                            Theo dõi tiến độ phân tích từng chỉ tiêu theo thời gian thực
                          </p>
                        </div>
                        <div class="col-md-4 text-end">
                          <div class="d-flex align-items-center justify-content-end">
                            <div class="me-3">
                              <small class="text-white-50 d-block">Tổng chỉ tiêu</small>
                              <h5 class="text-white mb-0" id="totalIndicators">0</h5>
                            </div>
                            <div>
                              <small class="text-white-50 d-block">Cần xử lý</small>
                              <h5 class="text-white mb-0" id="pendingIndicators">0</h5>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Thống kê tiến độ compact -->
              <div class="mb-3">
                <div class="progress-stats-grid" id="progressStatsContainer">
                  <!-- Các nút thống kê tiến độ sẽ được tạo động bằng JavaScript -->
                </div>
              </div>

              <!-- Bulk Actions Toolbar đã được di chuyển vào trong card bên dưới -->
              <hr class="my-2" />
              <!-- DataTable -->
              <div class="card">

                <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0"><i class="ri-flask-line me-2"></i>Danh sách chi tiết mẫu</h5>
                  <div class="d-flex gap-2">
                    <!-- Group By Dropdown -->
                    <div class="btn-group">
                      <button
                        type="button"
                        class="btn btn-outline-secondary btn-sm dropdown-toggle"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                        id="groupByDropdownBtn">
                        <i class="ri-group-line me-1"></i><span id="groupByLabel">Nhóm dữ liệu</span>
                      </button>
                      <ul class="dropdown-menu group-by-dropdown" id="groupByDropdown">
                        <li class="dropdown-header">Chọn cột để nhóm (có thể chọn nhiều)</li>
                        <li><hr class="dropdown-divider" /></li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="don_hang_id"
                                id="group_don_hang_id" />
                              <label class="form-check-label" for="group_don_hang_id">
                                <i class="ri-file-list-3-line me-1 text-primary"></i>Đơn hàng
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="ma_mau"
                                id="group_ma_mau" />
                              <label class="form-check-label" for="group_ma_mau">
                                <i class="ri-barcode-line me-1 text-info"></i>Mã mẫu
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="ten_don_hang"
                                id="group_ten_don_hang" />
                              <label class="form-check-label" for="group_ten_don_hang">
                                <i class="ri-file-text-line me-1 text-primary"></i>Tên đơn hàng
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="noi_phan_tich"
                                id="group_noi_phan_tich" />
                              <label class="form-check-label" for="group_noi_phan_tich">
                                <i class="ri-building-line me-1 text-warning"></i>Nơi phân tích
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="nguoi_phan_tich"
                                id="group_nguoi_phan_tich" />
                              <label class="form-check-label" for="group_nguoi_phan_tich">
                                <i class="ri-user-line me-1 text-success"></i>Người phân tích
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="nguoi_nhan"
                                id="group_nguoi_nhan" />
                              <label class="form-check-label" for="group_nguoi_nhan">
                                <i class="ri-user-received-line me-1 text-danger"></i>Người nhận
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="ten_chi_tieu"
                                id="group_ten_chi_tieu" />
                              <label class="form-check-label" for="group_ten_chi_tieu">
                                <i class="ri-test-tube-line me-1 text-purple"></i>Tên chỉ tiêu
                              </label>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="dropdown-item group-by-option">
                            <div class="form-check">
                              <input
                                class="form-check-input group-by-checkbox"
                                type="checkbox"
                                value="trang_thai_phan_tich"
                                id="group_trang_thai_phan_tich" />
                              <label class="form-check-label" for="group_trang_thai_phan_tich">
                                <i class="ri-progress-3-line me-1 text-info"></i>Trạng thái phân tích
                              </label>
                            </div>
                          </div>
                        </li>
                        <li><hr class="dropdown-divider" /></li>
                        <li>
                          <button class="dropdown-item text-center text-primary" id="applyGroupBtn">
                            <i class="ri-check-line me-1"></i>Áp dụng nhóm
                          </button>
                        </li>
                        <li>
                          <button class="dropdown-item text-center text-danger" id="clearGroupBtn">
                            <i class="ri-close-line me-1"></i>Bỏ nhóm
                          </button>
                        </li>
                      </ul>
                    </div>

                    <button type="button" style="display: none;" class="btn btn-primary btn-sm" id="addNewBtn">
                      <i class="ri-add-line me-1"></i>Thêm mới
                    </button>

                    <button type="button" class="btn btn-success btn-sm" id="exportExcelBtn">
                      <i class="ri-file-excel-2-line me-1"></i>Xuất Excel
                    </button>
                  </div>
                </div>

                <!-- Bulk Actions Toolbar - Hiển thị khi có checkbox được chọn -->
                <!-- Bulk Actions Toolbar - Compact Style -->
                <div id="bulkActionsToolbar" class="d-none py-2 px-3 bg-light border-bottom">
                  <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <!-- Left: Selected Count -->
                    <div class="d-flex align-items-center me-3">
                      <i class="ri ri-checkbox-multiple-line me-2 text-primary" style="font-size: 1.1rem"></i>
                      <span class="small">Đã chọn <strong id="selectedCount">0</strong> bản ghi</span>
                    </div>

                    <!-- Right: Action Buttons -->
                    <div class="d-flex align-items-center gap-1 flex-wrap">
                      <!-- Bulk Action Buttons - NEW WORKFLOW (9 states) -->
                      <button
                        type="button"
                        class="btn btn-warning btn-sm px-2 py-1"
                        id="bulkApproveThauBtn"
                        style="font-size: 0.8125rem; display: none">
                        <i class="ri ri-file-list-3-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Duyệt thầu</span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-success btn-sm px-2 py-1"
                        id="bulkReceiveBtn2"
                        style="font-size: 0.8125rem; display: none">
                        <i class="ri ri-inbox-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Nhận mẫu</span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-info btn-sm px-2 py-1"
                        id="bulkSendThauBtn"
                        style="font-size: 0.8125rem; display: none">
                        <i class="ri ri-mail-send-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Gửi mẫu thầu</span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-warning btn-sm px-2 py-1"
                        id="bulkUpdateResultBtn"
                        style="font-size: 0.8125rem; display: none">
                        <i class="ri ri-edit-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Cập nhật KQ</span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-primary btn-sm px-2 py-1"
                        id="bulkApproveBtn"
                        style="font-size: 0.8125rem; display: none">
                        <i class="ri ri-check-double-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Phê duyệt</span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-success btn-sm px-2 py-1"
                        id="bulkReanalyzedBtn"
                        style="font-size: 0.8125rem; display: none">
                        <i class="ri ri-refresh-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Đã PT lại</span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-secondary btn-sm px-2 py-1"
                        id="deselectAllBtn"
                        style="font-size: 0.8125rem">
                        <i class="ri ri-close-circle-line" style="font-size: 0.875rem"></i>
                        <span class="d-none d-lg-inline ms-1">Bỏ chọn</span>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="card-body">
                  <div class="table-responsive">
                    <table id="chiTietMauTable" class="table table-bordered dt-responsive nowrap w-100">
                      <thead>
                        <tr>
                          <th>
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="selectAll" />
                              <label class="form-check-label" for="selectAll"></label>
                            </div>
                          </th>
                          <th>Mã mẫu</th>
                          <th>Tên chỉ tiêu</th>
                          <th>Người phân tích</th>
                          <th>Tiến độ</th>
                          <th>Kết quả thực tế</th>
                          <th>Phê duyệt</th>
                          <th>Ngày nhận mẫu</th>
                          <th>Hạn hoàn thành</th>
                          <th>Thành tiền</th>
                          <th>Cảnh báo</th>
                          <th>Thao tác</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Data will be loaded here -->
                      </tbody>
                    </table>
                  </div>
                </div>

              </div>
            </div>
            <!-- / Content -->

            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
              <div class="container-fluid">
                <div
                  class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                  <div class="mb-2 mb-md-0">
                    ©
                    <script>
                      document.write(new Date().getFullYear());
                    </script>
                    <strong>CEFINEA</strong> - Hệ thống quản lý phòng thí nghiệm môi trường
                  </div>
                  
                </div>
              </div>
            </footer>

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>

    <!-- Modal: Bulk Edit Spreadsheet -->
    <div class="modal fade" id="bulkEditModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-spreadsheet">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="ri-edit-box-line me-2"></i>
              Chỉnh sửa hàng loạt - <span id="bulkEditRecordCount">0</span> bản ghi
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="spreadsheet-toolbar">
            <button type="button" class="btn btn-sm btn-outline-primary" id="addRowBtn">
              <i class="ri-add-line me-1"></i>Thêm dòng
            </button>
            <button type="button" class="btn btn-sm btn-outline-info" id="importExcelBtn">
              <i class="ri-file-excel-2-line me-1"></i>Import Excel
            </button>
            <div class="ms-auto">
              <small class="text-muted">Ctrl+C/V để copy/paste từ Excel</small>
            </div>
          </div>
          <div class="modal-body" id="spreadsheetContainer">
            <!-- x-spreadsheet will be initialized here -->
            <div class="text-center p-5">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Đang tải...</span>
              </div>
              <p class="mt-2">Đang khởi tạo bảng tính...</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
            <button type="button" class="btn btn-primary" id="saveBulkChangesBtn">
              <i class="ri-save-line me-1"></i>Lưu thay đổi
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Bulk Edit Spreadsheet -->
    <div class="modal fade" id="bulkEditModal" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="icon-base ri ri-edit-box-line me-2"></i>
              Chỉnh sửa hàng loạt - <span id="bulkEditCount">0</span> bản ghi
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <!-- Toolbar -->
            <div class="d-flex justify-content-between align-items-center p-3 border-bottom bg-light">
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-sm btn-outline-success" id="addRowBtn">
                  <i class="icon-base ri ri-add-line me-1"></i>Thêm dòng
                </button>
                <button type="button" class="btn btn-sm btn-outline-info" id="importExcelBtn">
                  <i class="icon-base ri ri-file-excel-2-line me-1"></i>Import Excel
                </button>
              </div>
              <div class="text-muted small">
                <i class="icon-base ri ri-information-line me-1"></i>
                Sử dụng Ctrl+C/V để copy/paste từ Excel. Tab/Enter để di chuyển giữa các ô.
              </div>
            </div>

            <!-- Spreadsheet Container -->
            <div id="bulkEditSpreadsheet" style="height: calc(100vh - 200px); overflow: auto"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="icon-base ri ri-close-line me-1"></i>Hủy
            </button>
            <button type="button" class="btn btn-primary" id="saveBulkChangesBtn">
              <i class="icon-base ri ri-save-line me-1"></i>Lưu thay đổi
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Cập nhật kết quả hàng loạt -->
    <div class="modal fade" id="bulkUpdateResultModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="icon-base ri ri-edit-line me-2"></i>
              Cập nhật kết quả phân tích hàng loạt cho <span id="updateResultCount">0</span> bản ghi
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="table-responsive" style="max-height: 500px; overflow-y: auto">
              <table class="table table-bordered table-hover" id="updateResultTable">
                <thead id="updateDataTableHead" class="table-light sticky-top">
                  <tr>
                    <th style="width: 100px">STT</th>
                    <th style="width: 150px">Mã mẫu</th>
                    <th style="width: 250px">Tên chỉ tiêu</th>
                    <th style="width: 150px">Kết quả thực tế</th>
                    <th style="width: 200px">Kết quả in phiếu</th>
                  </tr>
                </thead>
                <tbody id="updateResultTableBody">
                  <!-- Data will be inserted here by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="icon-base ri ri-close-line me-1"></i>Hủy
            </button>
            <button type="button" class="btn btn-primary" id="saveUpdateResultBtn">
              <i class="icon-base ri ri-save-line me-1"></i>Lưu kết quả
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Cập nhật nhà thầu hàng loạt -->
    <div class="modal fade" id="bulkUpdateContractorModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="icon-base ri ri-edit-line me-2"></i>
              Cập nhật duyệt thầu hàng loạt cho <span id="updateContractorCount">0</span> bản ghi
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="table-responsive" style="max-height: 500px; overflow-y: auto">
              <table class="table table-bordered table-hover" id="updateResultTable">
                <thead id="updateDataTableHead" class="table-light sticky-top">
                  <tr>
                    <th class="text-center" style="width: 100px">STT</th>
                    <th class="text-center" style="width: 150px">Mã mẫu</th>
                    <th class="text-center" style="width: 100px">Tên chỉ tiêu</th>
                    <th class="text-center" style="width: 300px">Nhà thầu</th>                  
                  </tr>
                </thead>
                <tbody id="updateContractorTableBody">
                  <!-- Data will be inserted here by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="icon-base ri ri-close-line me-1"></i>Hủy
            </button>
            <button type="button" class="btn btn-primary" id="saveUpdateContractorBtn">
              <i class="icon-base ri ri-save-line me-1"></i>Duyệt thầu
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Add/Edit Chi Tiet Mau -->    
    <div class="modal fade" id="chiTietMauModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="chiTietMauModalTitle">Chi tiết mẫu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <!-- Form sẽ được render động bởi FormBuilderService -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="ri-close-line me-1"></i>Đóng
            </button>
            <button type="submit" form="chiTietMauForm" class="btn btn-primary" id="saveBtn">
              <i class="ri-save-line me-1"></i>Lưu
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner d-none">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 mb-0">Đang xử lý...</p>
    </div>

    <!-- Core JS -->   
    <script src="./assets/vendor/libs/jquery/jquery.js"></script>    

    <script src="./assets/vendor/libs/popper/popper.js"></script>
    <script src="./assets/vendor/js/bootstrap.js"></script>
    <script src="./assets/vendor/libs/node-waves/node-waves.js"></script>

    <script src="./assets/vendor/libs/@algolia/autocomplete-js.js"></script>

    <script src="./assets/vendor/libs/pickr/pickr.js"></script>

    <script src="./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

    <script src="./assets/vendor/libs/hammer/hammer.js"></script>

    <script src="./assets/vendor/libs/i18n/i18n.js"></script>

    <script src="./assets/vendor/js/menu.js"></script>

    <!-- Vendors JS -->
    <script src="./assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
    <script src="./assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js"></script>
    <script src="./assets/vendor/libs/datatables-buttons-bs5/datatables-buttons-bootstrap5.js"></script>
    <!-- DataTables RowGroup from CDN -->
    <script src="https://cdn.datatables.net/rowgroup/1.4.0/js/dataTables.rowGroup.min.js"></script>
    <script src="./assets/vendor/libs/sweetalert2/sweetalert2.js"></script>
    <script src="./assets/vendor/libs/notyf/notyf.js"></script>

    <!-- XLSX for Excel export (thay vì sử dụng DataTables buttons export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Main JS -->
    <script src="./assets/js/main.js"></script>

    <!-- Demo -->
    <script src="./assets/js/data/create-data.js"></script>

    <!-- Data JS -->
    <script type="module" src="./assets/js/data/data.js"></script>

    <!-- API JS -->
    <script src="./assets/api/api-postgreSQL.js"></script>

    <!-- Helper JS -->
    <script src="./assets/js/configs/sample-details.config.js"></script>
    <script src="./assets/js/services/form-builder.service.js"></script>

    <!-- Service JS -->
    <script src="./assets/js/services/sample-details.service.js"></script>
    <script type="module" src="./assets/js/services/calc-by-formula.service.js"></script>

    <!-- Page JS -->
    <script type="module" src="./assets/js/app-sample-details.js"></script>

    <!-- Bulk Actions Module (loaded after main file) -->
    <script src="./assets/js/app-chi-tiet-mau-bulk-actions.js"></script>   
  </body>
</html>